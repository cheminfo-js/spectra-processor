!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.spectraProcessor=t():e.spectraProcessor=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";const n=Object.prototype.toString;e.exports=function(e){return n.call(e).endsWith("Array]")}},function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(5)),i=n(r(4)),a=n(r(2)),s=r(3);class l{constructor(e,t,r){const n=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).meta,o=void 0===n?{}:n;if(!r)throw new Error("Spectrum: id is mandatory");e&&e.length>1&&e[0]>e[1]?(this.x=e.reverse(),this.y=t.reverse()):(this.x=e||[],this.y=t||[]),this.id=r,this.meta=o,this.normalized=void 0}getXY(){return{x:this.x,y:this.y}}}l.prototype.getData=function(e){return function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).filter;let r={x:[],y:[]};return t&&(r=o(r,t)),r}(this,e)},l.prototype.updateNormalized=function(e){return this.normalized=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.from,n=void 0===r?e.x[0]:r,o=t.to,s=void 0===o?e.x[e.x.length-1]:o,l=t.numberOfPoints,f=void 0===l?1024:l,u=t.processes,c=void 0===u?[]:u,p=t.exclusions,h=void 0===p?[]:p,d=e.y.slice(0);for(let t of c)switch(t.kind){case"centerMean":{let t=a.mean(e.y),r=e=>e-t;d=d.map(r);break}case"scaleSD":{let t=a.standardDeviation(e.y),r=e=>e/t;d=d.map(r);break}default:console.error("Unknown process kind: ".concat(t.kind))}let m=i({x:e.x,y:d},{from:n,to:s,numberOfPoints:f,exclusions:h});return e.normalized=m,m}(this,e),this.normalized},l.fromJcamp=function(e,t,r){};const f={normalization:{},importation:{converter:e=>-Math.log10(e)},kind:"Infrared",display:{xLabel:"wavelength [cm-1]",xInverted:!0,yLabel:"Absorbance"}},u={normalization:{},kind:"Infrared",display:{xLabel:"wavelength [cm-1]",xInverted:!0,yLabel:"Absorbance"}};function c(e){const t=s.convert(e,{xy:!0}),r=function(e){let t=e.spectra[0].dataType.toLowerCase(),r=(e.spectra[0].xUnit.toLowerCase(),e.spectra[0].yUnit.toLowerCase());if(t.match(/infrared/))return r.match(/absorbance/)?u:f}(t),n=t.spectra[0].data[0];return r&&r.importation&&r.importation.converter&&(n.y=n.y.map(r.importation.converter)),{data:n,kind:r}}class p{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keepOriginalData=void 0!==e.keepOriginalData&&e.keepOriginalData,this.normalizationFilter=void 0,this.spectra=[]}setNormalizationFilter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.keepOriginalData&&this.spectra.length>0)throw new Error("Can not change normalization filter, missing original data. Use the option keepOriginalData=true.");this.normalizationFilter=e;for(let e of this.spectra)e.updateNormalized(this.normalizationFilter)}addFromJcamp(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1===(arguments.length>3&&void 0!==arguments[3]&&arguments[3])&&this.contains(t))return;let n=c(e);this.createAndAddSpectrum(n,t,r)}createAndAddSpectrum(e,t,r){let n=this.getSpectrumIndex(t);void 0===n&&(n=this.spectra.length);let o=new l(e.data.x,e.data.y,t,{meta:r});o.updateNormalized(this.normalizationFilter),this.spectra[n]=o}removeSpectrum(e){let t=this.getSpectrumIndex(e);if(void 0!==t)return this.data.splice(t,1)}contains(e){return!isNaN(this.getSpectrumIndex(e))}getSpectrumIndex(e){if(e)for(let t=0;t<this.spectra.length;t++){if(this.spectra[t].id===e)return t}}getNormalizedData(){if(!this.spectra||!this.spectra[0])return{};let e=[],t=[],r=[];for(let n of this.spectra)r.push(n.id),e.push(n.normalized.y),t.push(n.meta);return{ids:r,matrix:e,meta:t,x:this.spectra[0].normalized.x}}getChart(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e.ids,r=e.filter,n=void 0===r?{}:r,o=e.mode,i=void 0===o?this.mode:o;let a={data:[]};for(let e of this.spectra)if(!t||t.includes(e.id)){let t=e.getData({mode:i,filter:n});t.styles={unselected:{lineColor:e.meta.color||"darkgrey",lineWidth:1,lineStyle:1},selected:{lineColor:e.meta.color||"darkgrey",lineWidth:3,lineStyle:1}},t.label=e.meta.id||e.id,a.data.push(t)}return a}}console.log("--------",{SpectraProcessor:p}),t.SpectraProcessor=p},function(e,t,r){"use strict";function n(e,t){return e-t}t.sum=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t},t.max=function(e){for(var t=e[0],r=e.length,n=1;n<r;n++)e[n]>t&&(t=e[n]);return t},t.min=function(e){for(var t=e[0],r=e.length,n=1;n<r;n++)e[n]<t&&(t=e[n]);return t},t.minMax=function(e){for(var t=e[0],r=e[0],n=e.length,o=1;o<n;o++)e[o]<t&&(t=e[o]),e[o]>r&&(r=e[o]);return{min:t,max:r}},t.arithmeticMean=function(e){for(var t=0,r=e.length,n=0;n<r;n++)t+=e[n];return t/r},t.mean=t.arithmeticMean,t.geometricMean=function(e){for(var t=1,r=e.length,n=0;n<r;n++)t*=e[n];return Math.pow(t,1/r)},t.logMean=function(e){for(var t=0,r=e.length,n=0;n<r;n++)t+=Math.log(e[n]);return t/r},t.grandMean=function(e,t){for(var r=0,n=0,o=e.length,i=0;i<o;i++)r+=t[i]*e[i],n+=t[i];return r/n},t.truncatedMean=function(e,t,r){void 0===r&&(r=!1),r||(e=[].concat(e).sort(n));for(var o=e.length,i=Math.floor(o*t),a=0,s=i;s<o-i;s++)a+=e[s];return a/(o-2*i)},t.harmonicMean=function(e){for(var t=0,r=e.length,n=0;n<r;n++){if(0===e[n])throw new RangeError("value at index "+n+"is zero");t+=1/e[n]}return r/t},t.contraHarmonicMean=function(e){for(var t=0,r=0,n=e.length,o=0;o<n;o++)t+=e[o]*e[o],r+=e[o];if(r<0)throw new RangeError("sum of values is negative");return t/r},t.median=function(e,t){void 0===t&&(t=!1),t||(e=[].concat(e).sort(n));var r=e.length,o=Math.floor(r/2);return r%2==0?.5*(e[o-1]+e[o]):e[o]},t.variance=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,i=e.length,a=0;a<i;a++){var s=e[a]-n;o+=s*s}return r?o/(i-1):o/i},t.standardDeviation=function(e,r){return Math.sqrt(t.variance(e,r))},t.standardError=function(e){return t.standardDeviation(e)/Math.sqrt(e.length)},t.robustMeanAndStdev=function(e){var t=0,r=e.length,o=0;for(o=0;o<r;o++)t+=e[o];t/=r;var i=new Array(r);for(o=0;o<r;o++)i[o]=Math.abs(e[o]-t);return i.sort(n),{mean:t,stdev:r%2==1?i[(r-1)/2]/.6745:.5*(i[r/2]+i[r/2-1])/.6745}},t.quartiles=function(e,r){void 0===r&&(r=!1),r||(e=[].concat(e).sort(n));var o=e.length/4;return{q1:e[Math.ceil(o)-1],q2:t.median(e,!0),q3:e[Math.ceil(3*o)-1]}},t.pooledStandardDeviation=function(e,r){return Math.sqrt(t.pooledVariance(e,r))},t.pooledVariance=function(e,r){void 0===r&&(r=!0);for(var n=0,o=0,i=e.length,a=0;a<i;a++){var s=e[a],l=t.variance(s);n+=(s.length-1)*l,o+=r?s.length-1:s.length}return n/o},t.mode=function(e){var t,r=e.length,n=new Array(r);for(t=0;t<r;t++)n[t]=0;var o=new Array(r),i=0;for(t=0;t<r;t++){var a=o.indexOf(e[t]);a>=0?n[a]++:(o[i]=e[t],n[i]=1,i++)}var s=0,l=0;for(t=0;t<i;t++)n[t]>s&&(s=n[t],l=t);return o[l]},t.covariance=function(e,r,n){void 0===n&&(n=!0);var o=t.mean(e),i=t.mean(r);if(e.length!==r.length)throw"Vectors do not have the same dimensions";for(var a=0,s=e.length,l=0;l<s;l++){a+=(e[l]-o)*(r[l]-i)}return n?a/(s-1):a/s},t.skewness=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,i=0,a=e.length,s=0;s<a;s++){var l=e[s]-n;o+=l*l,i+=l*l*l}var f=o/a,u=i/a/Math.pow(f,1.5);return r?Math.sqrt(a*(a-1))/(a-2)*u:u},t.kurtosis=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=e.length,i=0,a=0,s=0;s<o;s++){var l=e[s]-n;i+=l*l,a+=l*l*l*l}var f=i/o;if(r){var u=i/(o-1);return o*(o+1)/((o-1)*(o-2)*(o-3))*(a/(u*u))-3*((o-1)*(o-1)/((o-2)*(o-3)))}return a/o/(f*f)-3},t.entropy=function(e,t){void 0===t&&(t=0);for(var r=0,n=e.length,o=0;o<n;o++)r+=e[o]*Math.log(e[o]+t);return-r},t.weightedMean=function(e,t){for(var r=0,n=e.length,o=0;o<n;o++)r+=e[o]*t[o];return r},t.weightedStandardDeviation=function(e,r){return Math.sqrt(t.weightedVariance(e,r))},t.weightedVariance=function(e,r){for(var n=t.weightedMean(e,r),o=0,i=e.length,a=0,s=0,l=0;l<i;l++){var f=e[l]-n,u=r[l];o+=u*(f*f),s+=u,a+=u*u}return o*(s/(s*s-a))},t.center=function(e,r){void 0===r&&(r=!1);var n=e;r||(n=[].concat(e));for(var o=t.mean(n),i=n.length,a=0;a<i;a++)n[a]-=o},t.standardize=function(e,r,n){void 0===r&&(r=t.standardDeviation(e)),void 0===n&&(n=!1);for(var o=e.length,i=n?e:new Array(o),a=0;a<o;a++)i[a]=e[a]/r;return i},t.cumulativeSum=function(e){var t=e.length,r=new Array(t);r[0]=e[0];for(var n=1;n<t;n++)r[n]=r[n-1]+e[n];return r}},function(e,t,r){"use strict";function n(){const e=/[, \t]+/,t=["TIC",".RIC","SCANNUMBER"];function r(e){var t=[];for(let r=0;r<e.length;r++)t.push(parseFloat(e[r]));return t}class n{}const o={keepRecordsRegExp:/^$/,xy:!1,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};function i(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function a(e){return-1!==t.indexOf(e)}function s(e,t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),t.shiftOffsetVal){var r=t.firstX-t.shiftOffsetVal;t.firstX=t.firstX-r,t.lastX=t.lastX-r}}function l(e,t){return e-t}function f(e,t){var r=e.yFactor,n=e.deltaX;e.isXYdata=!0;var o=[];e.data=[o];var i,a=e.firstX,s=e.firstY,l=!1;let f=0;for(;f<t.length;f++)if(13===(i=t.charCodeAt(f))||10===i)l=!0;else if(l)break;for(var u=!0,c=!1,p=!1,h=0,d=!1,m=!1,v=0,g=0,y=!1,b=!1,x=!1,w=0;f<=t.length;f++)if(i=f===t.length?13:t.charCodeAt(f),m)13!==i&&10!==i||(u=!0,m=!1);else if(i<=57&&i>=48)b=!0,w>0?v+=(i-48)/Math.pow(10,w++):(v*=10,v+=i-48);else if(44===i||46===i)b=!0,w++;else{if(b){if(u)u=!1,p&&(x=!0);else if(x)x=!1;else{c?(h=y?0-v:v,p=!0,c=!1):d||(g=y?0-v:v);for(var A=d?v-1:1,M=0;M<A;M++)p?s+=h:s=g,o.push(a),o.push(s*r),a+=n}y=!1,v=0,w=0,b=!1,d=!1}if(i<74&&i>63)b=!0,p=!1,v=i-64;else if(i>96&&i<106)b=!0,p=!1,v=i-96,y=!0;else if(115===i)b=!0,d=!0,v=9;else if(i>82&&i<91)b=!0,d=!0,v=i-82;else if(i>73&&i<83)b=!0,c=!0,v=i-73;else if(i>105&&i<115)b=!0,c=!0,v=i-105,y=!0;else if(36===i&&36===t.charCodeAt(f+1))b=!0,m=!0;else if(37===i)b=!0,c=!0,v=0,y=!1;else if(45===i){var F=t.charCodeAt(f+1);(F>=48&&F<=57||44===F||46===F)&&(b=!0,u||(p=!1),y=!0)}else 13!==i&&10!==i||(u=!0,m=!1)}}function u(e,t){var r,n=/(\(+|\)+|<+|>+|\s+)/g;e.isXYAdata=!0;var o=[];e.data=[o];var i=t.split(/,? *,?[;\r\n]+ */);for(let e=1;e<i.length;e++)r=i[e].trim().replace(n,"").split(","),o.push(parseFloat(r[0])),o.push(parseFloat(r[1]))}function c(e,t,r){var n,o=/\$\$.*/,i=/[,\t ]+/;e.isPeaktable=!0;var a=[];e.data=[a];var s=t.split(/,? *,?[;\r\n]+ */);for(let t=1;t<s.length;t++)if((n=s[t].trim().replace(o,"").split(i)).length%2==0)for(let t=0;t<n.length;t+=2)a.push(parseFloat(n[t])*e.xFactor),a.push(parseFloat(n[t+1])*e.yFactor);else r.logs.push("Format error: ".concat(n))}return function(p,h){var d,m,v,g,y,b,x,w=!(h=Object.assign({},o,h)).withoutXY,A=Date.now(),M={},F={};F.profiling=!!h.profiling&&[],F.logs=[];var S=[];F.spectra=S,F.info={};var O=new n;if("string"!=typeof p)throw new TypeError("the JCAMP should be a string");F.profiling&&F.profiling.push({action:"Before split to LDRS",time:Date.now()-A}),g=p.split(/[\r\n]+##/),F.profiling&&F.profiling.push({action:"Split to LDRS",time:Date.now()-A}),g[0]&&(g[0]=g[0].replace(/^[\r\n ]*##/,""));for(let t=0;t<g.length;t++){if((y=(d=g[t]).indexOf("="))>0?(m=d.substring(0,y),v=d.substring(y+1).trim()):(m=d,v=""),"DATATABLE"===(m=m.replace(/[_ -]/g,"").toUpperCase())&&(-1===(b=v.indexOf("\n"))&&(b=v.indexOf("\r")),b>0)){var E=-1,X=-1;if((x=v.substring(0,b).split(/[ ,;\t]+/))[0].indexOf("++")>0){var T=x[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),N=x[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");E=M.symbol.indexOf(T),X=M.symbol.indexOf(N)}-1===E&&(E=0),-1===X&&(X=0),M.first&&(M.first.length>E&&(O.firstX=M.first[E]),M.first.length>X&&(O.firstY=M.first[X])),M.last&&(M.last.length>E&&(O.lastX=M.last[E]),M.last.length>X&&(O.lastY=M.last[X])),M.vardim&&M.vardim.length>E&&(O.nbPoints=M.vardim[E]),M.factor&&(M.factor.length>E&&(O.xFactor=M.factor[E]),M.factor.length>X&&(O.yFactor=M.factor[X])),M.units&&(M.units.length>E&&(O.xUnit=M.units[E]),M.units.length>X&&(O.yUnit=M.units[X])),O.datatable=x[0],x[1]&&x[1].indexOf("PEAKS")>-1?m="PEAKTABLE":x[1]&&(x[1].indexOf("XYDATA")||x[0].indexOf("++")>0)&&(m="XYDATA",O.deltaX=(O.lastX-O.firstX)/(O.nbPoints-1))}if("XYDATA"!==m)if("PEAKTABLE"!==m)if("PEAKASSIGNMENTS"!==m){if("TITLE"===m)O.title=v;else if("DATATYPE"===m)O.dataType=v,v.indexOf("nD")>-1&&(F.twoD=!0);else if("NTUPLES"===m)v.indexOf("nD")>-1&&(F.twoD=!0);else if("XUNITS"===m)O.xUnit=v;else if("YUNITS"===m)O.yUnit=v;else if("FIRSTX"===m)O.firstX=parseFloat(v);else if("LASTX"===m)O.lastX=parseFloat(v);else if("FIRSTY"===m)O.firstY=parseFloat(v);else if("LASTY"===m)O.lastY=parseFloat(v);else if("NPOINTS"===m)O.nbPoints=parseFloat(v);else if("XFACTOR"===m)O.xFactor=parseFloat(v);else if("YFACTOR"===m)O.yFactor=parseFloat(v);else if("MAXX"===m)O.maxX=parseFloat(v);else if("MINX"===m)O.minX=parseFloat(v);else if("MAXY"===m)O.maxY=parseFloat(v);else if("MINY"===m)O.minY=parseFloat(v);else if("DELTAX"===m)O.deltaX=parseFloat(v);else if(".OBSERVEFREQUENCY"===m||"$SFO1"===m)O.observeFrequency||(O.observeFrequency=parseFloat(v));else if(".OBSERVENUCLEUS"===m)O.xType||(F.xType=v.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===m)F.indirectFrequency||(F.indirectFrequency=parseFloat(v));else if("$OFFSET"===m)F.shiftOffsetNum=0,O.shiftOffsetVal||(O.shiftOffsetVal=parseFloat(v));else if("$REFERENCEPOINT"===m);else if("VARNAME"===m)M.varname=v.split(e);else if("SYMBOL"===m)M.symbol=v.split(e);else if("VARTYPE"===m)M.vartype=v.split(e);else if("VARFORM"===m)M.varform=v.split(e);else if("VARDIM"===m)M.vardim=r(v.split(e));else if("UNITS"===m)M.units=v.split(e);else if("FACTOR"===m)M.factor=r(v.split(e));else if("FIRST"===m)M.first=r(v.split(e));else if("LAST"===m)M.last=r(v.split(e));else if("MIN"===m)M.min=r(v.split(e));else if("MAX"===m)M.max=r(v.split(e));else if(".NUCLEUS"===m)F.twoD&&(F.yType=v.split(e)[0]);else if("PAGE"===m){O.page=v.trim(),O.pageValue=parseFloat(v.replace(/^.*=/,"")),O.pageSymbol=O.page.replace(/[=].*/,"");var P=M.symbol.indexOf(O.pageSymbol),D="";M.units&&M.units[P]&&(D=M.units[P]),F.indirectFrequency&&"PPM"!==D&&(O.pageValue/=F.indirectFrequency)}else"RETENTIONTIME"===m?O.pageValue=parseFloat(v):a(m)?O[i(m)]=v:"SAMPLEDESCRIPTION"===m&&(O.sampleDescription=v);m.match(h.keepRecordsRegExp)&&(F.info[m]?(Array.isArray(F.info[m])||(F.info[m]=[F.info[m]]),F.info[m].push(v.trim())):F.info[m]=v.trim())}else w&&(v.match(/.*(XYA).*/)&&u(O,v),S.push(O),O=new n);else w&&(s(0,O),c(O,v,F),S.push(O),O=new n);else w&&(s(0,O),v.match(/.*\+\+.*/)?(O.deltaX||(O.deltaX=(O.lastX-O.firstX)/(O.nbPoints-1)),f(O,v)):c(O,v,F),S.push(O),O=new n)}if(F.profiling&&F.profiling.push({action:"Finished parsing",time:Date.now()-A}),Object.keys(M).length>0){var L=[],R=Object.keys(M);for(let e=0;e<R.length;e++){var C=R[e],Y=M[C];for(let e=0;e<Y.length;e++)L[e]||(L[e]={}),L[e][C]=Y[e]}F.ntuples=L}if(F.twoD&&w&&(function(e,t){var r=function(e){var t=e[0].data[0][0],r=t,n=e.length,o=e[0].data[0].length/2,i=new Array(n);for(let l=0;l<n;l++){i[l]=new Array(o);var a=e[l].data[0];for(let e=0;e<o;e++){var s=a[2*e+1];i[l][e]=s,s<t&&(t=s),s>r&&(r=s)}}const f=e[0].data[0][0],u=e[0].data[0][e[0].data[0].length-2],c=e[0].pageValue,p=e[n-1].pageValue;if(f>u)for(let e of i)e.reverse();return c>p&&i.reverse(),{z:i,minX:Math.min(f,u),maxX:Math.max(f,u),minY:Math.min(c,p),maxY:Math.max(c,p),minZ:t,maxZ:r,noise:(h=i[0].map(Math.abs),d=(h=h.sort(l)).length,h[Math.floor(d/2)])};var h,d}(e.spectra);t.noContour||(e.contourLines=function(e,t){for(var r,n,o,i,a,s,l,f,u,c,p,h,d,m=e.noise,v=e.z,g=v.length,y=v[0].length,b=e.minX,x=(e.maxX-b)/(y-1),w=e.minY,A=(e.maxY-w)/(g-1),M=e.minZ,F=e.maxZ,S=2*t.nbContourLevels,O=new Array(S),E=0;E<S;E++){var X={};O[E]=X;var T=E%2,N=(F-t.noiseMultiplier*m)*Math.exp((E>>1)-t.nbContourLevels);d=0===T?N+t.noiseMultiplier*m:0-N-t.noiseMultiplier*m;var P=[];if(X.zValue=d,X.lines=P,!(d<=M||d>=F))for(var D=0;D<g-1;D++)for(var L=v[D],R=v[D+1],C=0;C<y-1;C++)r=L[C],n=L[C+1],o=R[C],i=R[C+1],l=o>d,f=i>d,(a=r>d)!=(s=n>d)&&a!==l&&(u=C+(d-r)/(n-r),c=D,p=C,h=D+(d-r)/(o-r),P.push(u*x+b),P.push(c*A+w),P.push(p*x+b),P.push(h*A+w)),f!==s&&f!==l&&(u=C+1,c=D+1-(d-i)/(n-i),p=C+1-(d-i)/(o-i),h=D+1,P.push(u*x+b),P.push(c*A+w),P.push(p*x+b),P.push(h*A+w)),s!==l&&(u=(C+1-(d-n)/(o-n))*x+b,c=(D+(d-n)/(o-n))*A+w,s!==a&&(p=C+1-(d-n)/(r-n),h=D,P.push(u),P.push(c),P.push(p*x+b),P.push(h*A+w)),l!==a&&(p=C,h=D+1-(d-o)/(r-o),P.push(u),P.push(c),P.push(p*x+b),P.push(h*A+w)),s!==f&&(p=C+1,h=D+(d-n)/(i-n),P.push(u),P.push(c),P.push(p*x+b),P.push(h*A+w)),l!==f&&(p=C+(d-o)/(i-o),h=D+1,P.push(u),P.push(c),P.push(p*x+b),P.push(h*A+w)))}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:O}}(r,t),delete r.z),e.minMax=r}(F,h),F.profiling&&F.profiling.push({action:"Finished countour plot calculation",time:Date.now()-A}),h.keepSpectra||delete F.spectra),h.chromatogram&&(h.xy=!0),h.xy&&w&&S.length>0)for(let e=0;e<S.length;e++)if((O=S[e]).data.length>0)for(let e=0;e<O.data.length;e++){for(var z=O.data[e],U={x:new Array(z.length/2),y:new Array(z.length/2)},k=0;k<z.length;k+=2)U.x[k/2]=z[k],U.y[k/2]=z[k+1];O.data[e]=U}return h.chromatogram&&(F.spectra.length>1?function(e){var r=e.spectra,n=r.length,o={times:new Array(n),series:{ms:{dimension:2,data:new Array(n)}}},a=[];for(let e=0;e<t.length;e++){var s=i(t[e]);r[0][s]&&(a.push(s),o.series[s]={dimension:1,data:new Array(n)})}for(let e=0;e<n;e++){var l=r[e];o.times[e]=l.pageValue;for(let t=0;t<a.length;t++)o.series[a[t]].data[e]=parseFloat(l[a[t]]);l.data&&(o.series.ms.data[e]=[l.data[0].x,l.data[0].y])}e.chromatogram=o}(F):function(e){var t=e.spectra[0].data[0];e.chromatogram={times:t.x.slice(),series:{intensity:{dimension:1,data:t.y.slice()}}}}(F),F.profiling&&F.profiling.push({action:"Finished chromatogram calculation",time:Date.now()-A})),F.profiling&&F.profiling.push({action:"Total time",time:Date.now()-A}),F}}var o=n();var i,a={};e.exports={convert:function(e,t,r){return"boolean"==typeof t&&(r=t,t={}),r?function(e,t){var r;return i||(r=URL.createObjectURL(new Blob(["var getConverter =".concat(n.toString(),";var convert = getConverter(); onmessage = function (event) { var data = JSON.parse(event.data); postMessage(JSON.stringify({stamp: data.stamp, output: convert(data.input, data.options)})); };")],{type:"application/javascript"})),i=new Worker(r),URL.revokeObjectURL(r),i.addEventListener("message",function(e){var t=JSON.parse(e.data),r=t.stamp;a[r]&&a[r](t.output)})),new Promise(function(r){var n="".concat(Date.now()).concat(Math.random());a[n]=r,i.postMessage(JSON.stringify({stamp:n,input:e,options:t}))})}(e,t):o(e,t)},createTree:function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).flatten,r=void 0!==t&&t;if("string"!=typeof e)throw new TypeError("the JCAMP should be a string");let n,o=e.split(/[\r\n]+/),i=[],a=[],s=[],l=0,f=e.includes("## ");for(var u=0;u<o.length;u++){let e=o[u],t=f?e.replace(/ /g,""):e;if("##NTUPLES"===t.substring(0,9)&&l++,"##TITLE"===t.substring(0,7)){let r=[t.substring(8).trim()];for(let e=u+1;e<o.length&&!o[e].startsWith("##");e++)r.push(o[e].trim());a.push({title:r.join("\n"),jcamp:"".concat(e,"\n"),children:[]}),n=a[a.length-1],i.push(n)}else if("##END"===t.substring(0,5)&&0===l){n.jcamp+="".concat(e,"\n");var c=a.pop();0!==a.length?(n=a[a.length-1]).children.push(c):(n=void 0,s.push(c))}else if(n&&n.jcamp){n.jcamp+="".concat(e,"\n");var p=t.match(/^##(.*?)=(.+)/);p&&"DATATYPE"===p[1].replace(/[ _-]/g,"").toUpperCase()&&(n.dataType=p[2].trim())}"##END"===t.substring(0,5)&&l>0&&l--}return r?(i.forEach(e=>{e.children=void 0}),i):s}}},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==i(e)||o()(e)||(t=e,e=[]),!o()(e))throw new TypeError("input must be an array");var r=t,n=r.from,a=void 0===n?0:n,s=r.to,l=void 0===s?10:s,f=r.size,u=void 0===f?e.length:f,c=r.step;if(u&&c)throw new Error("step is defined by the array size");if(u||(u=c?Math.floor((l-a)/c)+1:l-a+1),!c&&u&&(c=(l-a)/(u-1)),Array.isArray(e)){e.length=0;for(var p=0;p<u;p++)e.push(a),a+=c}else{if(e.length!==u)throw new Error("sequentialFill typed array must have the correct length");for(var h=0;h<u;h++)e[h]=a,a+=c}return e};function s(e,t,r,n){return.5*r*t*t+n*t-(.5*r*e*e+n*e)}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.x,n=e.y,o=r.length,i=!1;r.length>1&&r[0]>r[1]&&(r=r.slice().reverse(),n=n.slice().reverse(),i=!0);let a=t.from,s=void 0===a?r[0]:a,l=t.to,u=void 0===l?r[o-1]:l,c=t.variant,p=void 0===c?"smooth":c,h=t.numberOfPoints,d=void 0===h?100:h,m=t.exclusions,v=void 0===m?[]:m;if(o!==n.length)throw new RangeError("the x and y vector doesn't have the same size.");if("number"!=typeof s||isNaN(s))throw new RangeError("'from' option must be a number");if("number"!=typeof u||isNaN(u))throw new RangeError("'to' option must be a number");if("number"!=typeof d||isNaN(d))throw new RangeError("'numberOfPoints' option must be a number");let g=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e>t){var o=[t,e];e=o[0],t=o[1]}n=n.filter(e=>void 0!==e.from&&void 0!==e.to),(n=JSON.parse(JSON.stringify(n))).forEach(e=>{if(e.from>e.to){var t=[e.from,e.to];e.to=t[0],e.from=t[1]}}),n.sort((e,t)=>e.from-t.from),n.forEach(r=>{r.from<e&&(r.from=e),r.to>t&&(r.to=t)});for(let e=0;e<n.length-1;e++)n[e].to>n[e+1].from&&(n[e].to=n[e+1].from);if(!(n=n.filter(e=>e.from<e.to))||0===n.length)return[{from:e,to:t,numberOfPoints:r}];let i=n.reduce((e,t)=>e+=t.to-t.from,0),a=(t-e-i)/r,s=[],l=e,f=0;for(let e of n){let t=Math.round((e.from-l)/a);f+=t,t>0&&s.push({from:l,to:e.from,numberOfPoints:t}),l=e.to}return r-f>0&&s.push({from:l,to:t,numberOfPoints:r-f}),s}(s,u,d,v),y=[],b=[];for(let e of g){let t=f(r,n,e.from,e.to,e.numberOfPoints,p);y.push(...t.x),b.push(...t.y)}return i?s<u?{x:y.reverse(),y:b.reverse()}:{x:y,y:b}:s<u?{x:y,y:b}:{x:y.reverse(),y:b.reverse()}}function f(e,t,r,n,o,i){if(o<1)throw new RangeError("the number of points must be at least 1");var l="slot"===i?function(e,t,r,n,o){var i=e.length,a=(n-r)/(o-1),s=a/2,l=e[e.length-1]-e[e.length-2],f=r-s,u=new Array(o),c=f,p=f+a,h=-Number.MAX_VALUE,d=0,m=e[0],v=t[0],g=0,y=!0,b=0,x=0,w=1,A=0;e:for(;;){if(h>=m)throw new Error("x must be an increasing serie");for(;h-p>0;){if(y&&(x++,y=!1),u[A]=x<=0?0:b/x,++A===o)break e;c=p,p+=a,b=0,x=0}h>c&&(b+=d,x++),(h===-Number.MAX_VALUE||g>1)&&x--,h=m,d=v,w<i?(m=e[w],v=t[w],w++):(m+=l,v=0,g++)}return u}(e,t,r,n,o):function(e,t,r,n,o){var i=e.length,a=(n-r)/(o-1),l=a/2,f=new Array(o),u=e[1]-e[0],c=e[i-1]-e[i-2],p=r-l,h=r+l,d=Number.MIN_VALUE,m=0,v=e[0]-u,g=0,y=0,b=0,x=0,w=0,A=0,M=0,F=0;e:for(;;){for(d<=p&&p<=v&&(w=y+(S=s(0,p-d,b,m)));v-h>=0;){var S=s(0,h-d,b,m);if(A=y+S,f[F++]=(A-w)/a,F===o)break e;p=h,h+=a,w=A}y+=s(d,v,b,x),d=v,m=g,M<i?(v=e[M],g=t[M],M++):M===i&&(v+=c,g=0),x=-(b=(g-m)/(v-d))*d+m}return f}(e,t,r,n,o);return{x:a({from:r,to:n,size:o}),y:l}}r.d(t,"default",function(){return l})},function(e,t,r){"use strict";function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e.x,n=e.y,o=t.from,i=void 0===o?r[0]:o,a=t.to,s=void 0===a?r[r.length-1]:a,l=t.exclusions;let f=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e>t){var n=[t,e];e=n[0],t=n[1]}r=r.filter(e=>void 0!==e.from&&void 0!==e.to),(r=JSON.parse(JSON.stringify(r))).forEach(e=>{if(e.from>e.to){var t=[e.from,e.to];e.to=t[0],e.from=t[1]}}),r.sort((e,t)=>e.from-t.from),r.forEach(r=>{r.from<e&&(r.from=e),r.to>t&&(r.to=t)});for(let e=0;e<r.length-1;e++)r[e].to>r[e+1].from&&(r[e].to=r[e+1].from);if(!(r=r.filter(e=>e.from<e.to))||0===r.length)return[{from:e,to:t}];let o=[],i=e;for(let e of r)i<e.from&&o.push({from:i,to:e.from}),i=e.to;return i<t&&o.push({from:i,to:t}),o}(i,s,void 0===l?[]:l),u=0,c=[],p=[],h=0;for(;h<r.length;){if(r[h]<=f[u].to&&r[h]>=f[u].from)c.push(r[h]),p.push(n[h]);else if(r[h]>f[u].to&&!f[++u])break;h++}return{x:c,y:p}}r.r(t),r.d(t,"default",function(){return n})}])});
//# sourceMappingURL=spectra-processor.min.js.map